<template>
  <div class="login-container">
    <div class="brand-section">
      <div class="bg-overlay"></div>
      <div class="brand-content">
        <div class="logo">
          <el-icon :size="40" color="#fff"><Apple /></el-icon>
          <span>SmartNutri</span>
        </div>
        <h1 class="slogan">ç§‘å­¦é¥®é£Ÿï¼Œ<br>é‡ è§ æ›´ å¥½ çš„ è‡ª å·±ã€‚</h1>
        <p class="sub-slogan">åŸºäº AI å¤§æ¨¡å‹çš„ä¸ªæ€§åŒ–è†³é£Ÿç®¡ç†å¹³å°</p>
        <div class="features">
          <span class="tag"><el-icon><Camera /></el-icon> æ‹ç…§è¯†èœ</span>
          <span class="tag"><el-icon><DataAnalysis /></el-icon> çƒ­é‡ç›‘æ§</span>
          <span class="tag"><el-icon><ChatDotRound /></el-icon> AI é¡¾é—®</span>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-wrapper">
        <h2 class="welcome-text">
          {{ isLogin ? 'æ¬¢è¿å›æ¥ ğŸ‘‹' : 'åˆ›å»ºè´¦æˆ· ğŸš€' }}
        </h2>
        <p class="tip-text">
          {{ isLogin ? 'è¯·è¾“å…¥æ‚¨çš„è´¦å·ä¿¡æ¯ä»¥ç™»å½•å¹³å°' : 'å¼€å¯æ‚¨çš„å¥åº·ç®¡ç†ä¹‹æ—…' }}
        </p>

        <el-form
          v-if="isLogin"
          ref="loginFormRef"
          :model="loginForm"
          :rules="rules"
          class="auth-form"
          size="large"
        >
          <el-form-item prop="username">
            <el-input 
              v-model="loginForm.username" 
              placeholder="ç”¨æˆ·å / æ‰‹æœºå·" 
              prefix-icon="User"
            />
          </el-form-item>
          <el-form-item prop="password">
            <el-input 
              v-model="loginForm.password" 
              type="password" 
              placeholder="å¯†ç " 
              prefix-icon="Lock"
              show-password
            />
          </el-form-item>
          
          <div class="form-options">
            <el-checkbox v-model="loginForm.remember">è®°ä½æˆ‘</el-checkbox>
            <el-link type="primary" :underline="false">å¿˜è®°å¯†ç ï¼Ÿ</el-link>
          </div>

          <el-button type="primary" class="submit-btn" :loading="loading" @click="handleLogin">
            ç«‹å³ç™»å½•
          </el-button>
        </el-form>

        <el-form
          v-else
          ref="registerFormRef"
          :model="registerForm"
          :rules="rules"
          class="auth-form"
          size="large"
        >
          <el-form-item prop="username">
            <el-input 
              v-model="registerForm.username" 
              placeholder="è®¾ç½®ç”¨æˆ·å" 
              prefix-icon="User"
            />
          </el-form-item>
          <el-form-item prop="phone">
            <el-input 
              v-model="registerForm.phone" 
              placeholder="æ‰‹æœºå·ç " 
              prefix-icon="Iphone"
            />
          </el-form-item>
          <el-form-item prop="password">
            <el-input 
              v-model="registerForm.password" 
              type="password" 
              placeholder="è®¾ç½®å¯†ç " 
              prefix-icon="Lock"
              show-password
            />
          </el-form-item>

          <el-button type="success" class="submit-btn" :loading="loading" @click="handleRegister">
            ç«‹å³æ³¨å†Œ
          </el-button>
        </el-form>

        <div class="toggle-box">
          <span>{{ isLogin ? 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ' : 'å·²æœ‰è´¦å·ï¼Ÿ' }}</span>
          <el-link type="primary" :underline="false" @click="toggleState">
            {{ isLogin ? 'å»æ³¨å†Œ' : 'å»ç™»å½•' }}
          </el-link>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue';
import { useRouter } from 'vue-router';
import { ElMessage } from 'element-plus';
import { User, Lock, Apple, Camera, DataAnalysis, ChatDotRound, Iphone } from '@element-plus/icons-vue';

const router = useRouter();
const isLogin = ref(true); // æ§åˆ¶ç™»å½•/æ³¨å†Œåˆ‡æ¢
const loading = ref(false);

// è¡¨å•æ•°æ®
const loginForm = reactive({
  username: '',
  password: '',
  remember: false
});

const registerForm = reactive({
  username: '',
  phone: '',
  password: ''
});

// è¡¨å•æ ¡éªŒè§„åˆ™
const rules = {
  username: [
    { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' },
    { min: 3, message: 'é•¿åº¦è‡³å°‘ 3 ä¸ªå­—ç¬¦', trigger: 'blur' }
  ],
  password: [
    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
    { min: 6, message: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº 6 ä½', trigger: 'blur' }
  ],
  phone: [
    { required: true, message: 'è¯·è¾“å…¥æ‰‹æœºå·', trigger: 'blur' },
    { pattern: /^1[3-9]\d{9}$/, message: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®', trigger: 'blur' }
  ]
};

// åˆ‡æ¢ç™»å½•/æ³¨å†ŒçŠ¶æ€
const toggleState = () => {
  isLogin.value = !isLogin.value;
  // æ¸…ç©ºè¡¨å•éªŒè¯çŠ¶æ€ï¼ˆå®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦è°ƒç”¨ formRef.value.resetFields()ï¼‰
};

// æ¨¡æ‹Ÿç™»å½•é€»è¾‘
const handleLogin = () => {
  // è¿™é‡Œæš‚æ—¶åªåšç®€å•çš„éç©ºåˆ¤æ–­ï¼Œå®é™…éœ€è¦è°ƒç”¨ formRef.validate
  if (!loginForm.username || !loginForm.password) {
    ElMessage.warning('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
    return;
  }

  loading.value = true;
  
  // æ¨¡æ‹Ÿæ¥å£è¯·æ±‚å»¶è¿Ÿ
  setTimeout(() => {
    loading.value = false;
    ElMessage.success('ç™»å½•æˆåŠŸï¼Œæ¬¢è¿å›æ¥ï¼');
    // å­˜å‚¨ Token (æ¨¡æ‹Ÿ)
    localStorage.setItem('userToken', 'mock-token-123456');
    // è·³è½¬åˆ°ä»ªè¡¨ç›˜
    router.push('/dashboard');
  }, 1500);
};

// æ¨¡æ‹Ÿæ³¨å†Œé€»è¾‘
const handleRegister = () => {
  if (!registerForm.phone || !registerForm.password) {
    ElMessage.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
    return;
  }
  
  loading.value = true;
  setTimeout(() => {
    loading.value = false;
    ElMessage.success('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
    isLogin.value = true; // åˆ‡æ¢å›ç™»å½•é¡µ
  }, 1500);
};
</script>

<style scoped lang="scss">
.login-container {
  display: flex;
  height: 100vh;
  width: 100vw;
  background-color: #fff;
  overflow: hidden;

  // å·¦ä¾§å“ç‰ŒåŒº
  .brand-section {
    flex: 1;
    position: relative;
    background-image: url('https://images.unsplash.com/photo-1490645935967-10de6ba17061?q=80&w=2053&auto=format&fit=crop'); // ä½¿ç”¨ Unsplash çš„å¥åº·é£Ÿç‰©å›¾ç‰‡
    background-size: cover;
    background-position: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 60px;
    color: #fff;

    // ç§»åŠ¨ç«¯éšè—å·¦ä¾§
    @media (max-width: 900px) {
      display: none;
    }

    .bg-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      // æ¸å˜è’™å±‚ï¼Œè®©æ–‡å­—æ›´æ¸…æ™°ï¼ŒåŒæ—¶èå…¥å“ç‰Œè‰²
      background: linear-gradient(135deg, rgba(66, 185, 131, 0.9) 0%, rgba(36, 126, 88, 0.8) 100%);
      z-index: 1;
    }

    .brand-content {
      position: relative;
      z-index: 2;

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 40px;
      }

      .slogan {
        font-size: 48px;
        line-height: 1.2;
        font-weight: 800;
        margin-bottom: 20px;
        letter-spacing: 2px;
      }

      .sub-slogan {
        font-size: 20px;
        opacity: 0.9;
        margin-bottom: 60px;
      }

      .features {
        display: flex;
        gap: 20px;
        
        .tag {
          display: flex;
          align-items: center;
          gap: 8px;
          background: rgba(255, 255, 255, 0.2);
          padding: 8px 16px;
          border-radius: 50px;
          backdrop-filter: blur(10px);
          font-size: 14px;
        }
      }
    }
  }

  // å³ä¾§è¡¨å•åŒº
  .form-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    padding: 40px;

    .form-wrapper {
      width: 100%;
      max-width: 420px;
      
      .welcome-text {
        font-size: 32px;
        color: #333;
        margin-bottom: 10px;
      }
      
      .tip-text {
        color: #999;
        margin-bottom: 40px;
        font-size: 14px;
      }

      .auth-form {
        // è‡ªå®šä¹‰ Element è¾“å…¥æ¡†æ ·å¼ï¼Œä½¿å…¶æ›´å¤§æ°”
        :deep(.el-input__wrapper) {
          padding: 12px 15px;
          border-radius: 8px;
          box-shadow: 0 0 0 1px #dcdfe6 inset;
          
          &.is-focus {
            box-shadow: 0 0 0 1px #42b983 inset !important;
          }
        }
        
        .submit-btn {
          width: 100%;
          padding: 22px 0;
          font-size: 16px;
          border-radius: 8px;
          margin-top: 20px;
          background-color: #42b983; // å“ç‰Œè‰²
          border-color: #42b983;
          font-weight: bold;
          letter-spacing: 1px;
          transition: all 0.3s;

          &:hover {
            background-color: #3aa876;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 185, 131, 0.3);
          }
        }
      }

      .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .toggle-box {
        margin-top: 30px;
        text-align: center;
        font-size: 14px;
        color: #666;

        span {
          margin-right: 5px;
        }
      }
    }
  }
}
</style>